# 공행성쌍(Leading-Following Pair) 탐색 파라미터 및 실험 결과 정리

---

## 1. 공행성쌍 탐색 파라미터

- **max_lag** (int, 기본값=6)  
  → 리더와 팔로워 품목 간 최대 시차(개월)
- **min_nonzero** (int, 기본값=12)  
  → 0이 아닌 거래량을 기록한 최소 월 개수
- **corr_threshold** (float, 기본값=0.4)  
  → 피어슨 상관계수의 절댓값 임계값

### 파라미터 조합별 탐색 결과

| 파라미터 조합                                 | 탐색된 쌍 수 | 리더보드 점수 |
|-----------------------------------------------|:------------:|:------------:|
| max_lag=6, min_nonzero=12, corr_threshold=0.4 |    1425      |   0.2717     |
| max_lag=3, min_nonzero=12, corr_threshold=0.4 |     867      |   0.2123     |
| max_lag=6, min_nonzero=12, corr_threshold=0.7 |      55      |   0.0160     |

- 실험을 통해 파라미터 기준을 조정하며 ‘공행성쌍’ 정의 탐색
- 제출 횟수 제한으로 F1 Score보다 NMAE Score 중심 전략 택함

---

## 2. 검증 전략 및 개선점

- 내부적으로 공행성쌍 탐색 결과 검증이 미흡해 **1 - NMAE 값 최적화**에 집중
- 예시  
    - 2025년 7월: 검증셋  
    - 나머지: 학습셋  
    - F1 Score: 약 0.98(매우 높음)  
    - 1-NMAE 점수는 낮게 나옴  
    → 검증의 한계 뚜렷  
- 추후 2024년 8월 ~ 2025년 7월 등 다양한 검증셋으로 확장 예정

---

# NMAE Score 개선 전략 및 실험 결과

## 모델별 성능 비교

| 모델               | NMAE    | NMAE Score | 평균 절대 오차 | 중위수 상대 오차 | 예측-정답 합계 차이(%) |
|--------------------|---------|:----------:|:--------------:|:----------------:|:----------------------:|
| RandomForest       | 0.4738  |   0.5262   |   1,617,468    |      0.3728      |         23.83          |
| GradientBoosting   | 0.5000  |   0.5000   |   1,533,726    |      0.4150      |         19.31          |
| XGBoost            | 0.5119  |   0.4881   |   1,774,326    |      0.4226      |         23.25          |
| Ridge              | 0.5670  |   0.4330   |   1,637,717    |      0.4709      |         21.43          |
| LinearRegression   | 0.5670  |   0.4330   |   1,637,718    |      0.4709      |         21.43          |
| Lasso              | 0.5670  |   0.4330   |   1,637,718    |      0.4709      |         21.43          |

> **NMAE Score 기준** : `RandomForest`가 가장 우수

---

## 3. 총평 및 추진 전략

- 리더보드 제출 제한 → 로컬 검증 결과 신뢰도 중요
- 현 단계에서는 **RandomForest** 기반으로 NMAE Score 개선 우선

### 다음 단계

1. **신규 Feature 생성**  
   → 추가 EDA 및 파생변수 설계
2. **RandomForest 하이퍼파라미터 튜닝**  
   → 간단 탐색부터 순차 적용

초기에는 RandomForest만 하이퍼파라미터 튜닝을 고려했으나,  
학습시간 부담이 크지 않아 **모든 모델**에 대해 하이퍼파라미터 탐색 및 비교를 진행

---

## 하이퍼파라미터 탐색 결과

| 모델             | n_estimators | min_samples_split | min_samples_leaf | max_features | max_depth | learning_rate | subsample |    NMAE    | NMAE Score |
|------------------|:------------:|:-----------------:|:----------------:|:------------:|:---------:|:-------------:|:---------:|:----------:|:-----------:|
| RandomForest     |     50       |         2         |        1         |    None      |    25     |      -        |     -     | 0.466018   |  0.533982   |
| GradientBoosting |    300       |         2         |        2         |      -       |    10     |    0.15       |    1.0    | 0.460592   |  0.539408   |


---

## 앙상블 결과 요약

| 구성         | 가중치  |
|--------------|--------|
| RandomForest | 0.20   |
| GradBoosting | 0.80   |

- **앙상블 NMAE**: 0.456037
- **앙상블 NMAE Score**: 0.543963

## 요약

- **Feature Engineering**이 필요하며, 이를 위해 당분간 **EDA**에 집중할 계획이다.
- 적절한 특성을 설계한 뒤, **RandomForest**와 **GradientBoosting** 기반으로 하이퍼파라미터 탐색을 진행하여 최적 모델을 구성할 예정이다.
- 최종적으로 두 모델을 앙상블하여 성능 향상을 도모할 것이다.
- 공행성쌍 관련 처리는 리더보드 제출을 통한 반복 실험(노가다)이 불가피할 것으로 보인다.